define(function(){function a(a){this.dom=a.dom,this.wrap=a.wrap,this.init()&&(this.renderDOM(),this.bindDom())}var b=function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)},c=function(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;e>d;d++)if(c[d]==b)return!0;return!1},d=function(a,b){a.className?(newClassName=a.className,newClassName+=" ",newClassName+=b,a.className=newClassName):a.className=b},e=function(a,b){if(a.className==b)try{a.removeAttribute("class")}catch(c){a.className=""}},f=function(a){var b=a.split(" "),d=b.length,e=document.getElementsByTagName("*"),f=e.length;if(1===d){var g=b.toString();switch(g.substr(0,1)){case"#":return document.getElementById(g.substr(1));case".":if(document.getElementsByClassName)return document.getElementsByClassName(g.substr(1));for(var h=[],i=0;f>i;i++)c(e[i],g.substr(1))&&h.push(e[i]);return h;case"[":if("]"!==g.charAt(g.length-1))throw Error("']' is missing !");var j=g.substring(1,g.length-1);if(-1!=j.indexOf("=")){for(var k=j.split("="),l=0;f>l;l++)if(e[l].getAttribute(k[0])===k[1])return e[l]}else for(var i=0;f>i;i++)if(e[i].hasAttribute(j))return e[i];break;default:return document.getElementsByTagName(g)}}else for(var m=1;d>m;i++)if("#"==b[0].substr(0,1)){var n=document.getElementById(b[0].substr(1));switch(b[m].substr(0,1)){case".":return n.getElementsByClassName(b[m].substr(1))[0];default:return n.getElementsByTagName(b[m])}}else if("."==b[0].substr(0,1)){var o=document.getElementsByClassName(b[0].substr(1));switch(b[m].substr(0,1)){case"#":return o.getElementById(b[m].substr(1));default:return n.getElementsByTagName(b[m])}}},g=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},h=function(a,b){a.addEventListener?a.addEventListener("click",b,!1):a.attachEvent?a.attachEvent("onclick",b):a.onclick=b},i=function(a){a&&a.stopPropagation?a.stopPropagation():window.event.cancelBubble=!0},j=function(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1},k=function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c])},l=function(a,b){for(var c=0,d=a.length;d>c;c++)h(a[c],b)},m=function(a,b){for(var c=a.parentNode.children,f=0,g=c.length;g>f;f++)e(c[f],b);d(a,b)};Array.prototype.indexOf=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return b;return-1},Array.prototype.remove=function(a){var b=this.indexOf(a);b>-1&&this.splice(b,1)},a.prototype.init=function(){return this.idx=0,this.innerW=window.innerWidth,this.innerW<=768?!0:!1},a.prototype.renderDOM=function(){var a=this.innerW,c=this.dom,d=this.wrap;768>=a&&(d.style.width=a+"px",b(c,function(b,c){b.style.width=a+"px",b.style.display="inline-block",b.style.position="absolute",b.style.webkitTransform="translate3d("+a*c+"px, 0, 0)"}))},a.prototype.goIndex=function(a){var b=this.idx,c=this.dom,d=this.dom.length,e=0;"number"==typeof a?e=a:"string"==typeof a&&(e=b+1*a),e>d-1?e=d-1:0>e&&(e=0),this.idx=e,c[e].style.webkitTransition="-webkit-transform .3s ease-out",c[e-1]&&(c[e-1].style.webkitTransition="-webkit-transform .3s ease-out"),c[e+1]&&(c[e+1].style.webkitTransition="-webkit-transform .3s ease-out"),c[e].style.webkitTransform="translate3d(0, 0, 0)";for(var g=0;e>g;g++)c[g]&&(c[g].style.webkitTransform="translate3d(-"+this.innerW+"px, 0, 0)");for(var h=e+1;d>h;h++)c[h]&&(c[h].style.webkitTransform="translate3d("+this.innerW+"px, 0, 0)");var i=f(".todo-nav")[0],j=i.getElementsByTagName("ul")[0];switch(e){case 0:j.style.borderTop="2px solid #7690B4";break;case 1:j.style.borderTop="2px solid #EBB74C";break;case 2:j.style.borderTop="2px solid #E8919F"}},a.prototype.bindDom=function(){var a=this,b=a.innerW,c=a.wrap,d=function(b){i(b),b=b||window.event;var c=b.target||b.srcElement;a.startTime=1*new Date,a.startX=b.touches[0].pageX,a.startY=b.touches[0].pageY,"SECTION"==c.nodeName.toUpperCase()&&(a.target=c)},e=function(c){i(c),a.offsetX=c.targetTouches[0].pageX-a.startX,a.offsetY=c.targetTouches[0].pageY-a.startY,a.offsetY<50&&Math.abs(a.offsetX)>15&&j(c);var d=a.dom,e=a.idx-1,f=d.length;for(e;f>e;e++)d[e]&&(d[e].style.webkitTransition="-webkit-transform 0s ease-out"),d[e]&&(d[e].style.webkitTransform="translate3d("+((e-a.idx)*b+a.offsetX)+"px, 0, 0)")},f=function(c){i(c);var d=b/12,e=1*new Date;if(e-a.startTime>150)switch(!0){case a.offsetX>=d:a.goIndex("-1");break;case a.offsetX<0&&a.offsetX<-d:a.goIndex("+1");break;default:a.goIndex("0")}else switch(!0){case a.startX<10:a.goIndex("-1");break;case a.startX>b-10:a.goIndex("+1");break;default:a.goIndex(a.idx)}};g(c,"touchstart",d),g(c,"touchmove",e),g(c,"touchend",f)};var n=function(a,b){for(var c="",d=0,e=0,f=a.length;f>e;e++){if(d+=null!=a[e].match(/[^\x00-\xff]/gi)?2:1,d>b)return alert("名称不能超过十位汉字！请重新想个简短的名字吧~"),init.addCateName.value="",!1;if(0==d)return alert("名称不能为空！快起个名字吧~"),init.addCateName.value="",!1;c+=a[e]}return c},o=function(a){var b=a.split("-"),c=parseInt(b[0]),d=parseInt(b[1]-1),e=parseInt(b[2]),f=new Date,g=new Date(c,d,e);return f>g?(alert("任务日期设置的太超前啦~再检查一下~"),!1):g},p=function(a){for(var b=new RegExp("[$*()=|'\\[\\].<>/@#&{}]"),c="",d=0,e=a.length;e>d;d++)c+=a.substr(d,1).replace(b,"");return c},q=function(a,b,c){var d=/^(\d{4})\-(\d{2})\-(\d{2})$/;if(""==a.value||""==b.value||""==c.value)return alert("请仔细检查任务，查看是否填写完整~"),!1;if(!n(a.value,20))return!1;var e=p(n(a.value,20));if(!d.test(b.value)||!o(b.value))return!1;var f=o(b.value);if(!c.value)return!1;var g=p(c.value);return[e,f,g]},r=function(a){return function(b,c){var d=b[a],e=c[a];return e>d?-1:d>e?1:0}},s=function(a){var b=new Date(a.time);if(b){var c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate();return 10>d&&(d="0"+d),10>e&&(e="0"+e),[c,d,e].join("-")}};return{formatTime:s,compare:r,checkTask:q,checkXSS:p,getByteVal:n,silder:new a({dom:f("section"),wrap:f(".todo-container")[0]}),delegateInitClass:m,delegateClickEvent:l,delegateEleEvent:k,stopBubble:i,addClickEvent:h,addEvent:g,hasClass:c,$:f,removeClass:e,addClass:d,each:b}});