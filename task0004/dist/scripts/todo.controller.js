define(["util","data","render"],function(a,b,c){var d={todoAddTask:a.$("#todo-add-task"),todoCateBtn:a.$("#todo-add-category"),todoCateAll:a.$(".todo-category-total")[0],addCateName:a.$("#add-cate-name"),addCateCancel:a.$("#add-cate-cancel"),addCateCheck:a.$("#add-cate-check"),todoNav:[a.$("#todo-nav-cates"),a.$("#todo-nav-inves"),a.$("#todo-nav-tasks")]},e=function(){a.silder.init()&&a.silder.renderDOM(),a.each(b.cates,c.addCate),a.each(b.lists,c.addList),c.addInventory(b.tasks[0]),c.addContent(b.tasks[0]),c.renderFirstItem(),c.renderCount(),a.each(b.cates,function(a){c.addCateOption(a.category)}),a.delegateClickEvent(c.todoInventory,c.classToggle),a.delegateClickEvent(c.todoTaskItem,c.classToggle),a.delegateClickEvent(c.removeIcon,c.removeClick),a.delegateClickEvent(c.todoTaskItem,c.taskItemClick),a.each(d.todoNav,function(b){a.addClickEvent(b,c.silderGo)})},f=function(){a.addClickEvent(d.todoCateBtn,function(){c.addCatePanel("block"),d.addCateCheck&&a.addClickEvent(d.addCateCheck,function(){var a=c.addCateSelect.value,b=d.addCateName.value;c.addCateList(a,b),d.addCateName.value="",c.addCatePanel("none")}),d.addCateCancel&&a.addClickEvent(d.addCateCancel,function(){d.addCateName.value="",c.addCatePanel("none")})}),a.addClickEvent(d.todoCateAll,function(){a.each(c.todoTaskItem,function(b){a.removeClass(b,"todo-task-selected")}),c.refreshInventory(b.tasks,"all","all"),a.silder.init()&&a.silder.goIndex("1")}),a.addClickEvent(d.todoAddTask,function(){var d=a.$(".todo-task-selected")[0],e={};if(d&&"LI"===d.nodeName){var f=d.getAttribute("data-list-id");"使用说明"===f?alert("【使用说明】不能新建子任务啦~"):a.each(b.lists,function(b){b.taskList===f&&(confirm("将在【"+b.category+"】分类下的【"+f+"】列表新增任务~")&&c.renderEditChange("new"),e={category:b.category,taskList:f},a.silder.init()&&a.silder.goIndex("2"))}),c.todoCheckEle.onclick=function(){if(a.checkTask(c.todoEdit[0],c.todoEdit[1],c.todoEdit[2])&&confirm("确认新建【"+c.todoEdit[0].value+"】任务吗？")){var d=a.checkTask(c.todoEdit[0],c.todoEdit[1],c.todoEdit[2]);b.tasks.push(new b.TaskDetail({cateList:e,title:d[0],time:d[1],content:d[2],isDone:!1})),a.each(b.tasks,function(a,b){a.id=b}),b.updateData(b.cates,b.lists,b.tasks),c.refreshCate(b.cates,b.lists),c.refreshInventory(b.tasks,f,"all"),c.renderEditChange("check"),a.each(b.tasks,function(a){a.id===b.tasks.length-1&&c.addContent(a)}),a.silder.init()&&a.silder.goIndex("1")}}}else alert("【新增任务】需要选中【目标分类】喔~╰(￣▽￣)╭")}),a.delegateClickEvent(c.todoInventory,function(d){d=d||window.event;var e=d.target||d.srcElement;a.stopBubble(d);var f=a.$(".todo-task-selected")[0];if(f)var g=f.getAttribute("data-list-id");else g="all";switch(e.getAttribute("id")){case"todo-all":c.refreshInventory(b.tasks,g,"all");break;case"todo-doing":c.refreshInventory(b.tasks,g,!1);break;case"todo-done":c.refreshInventory(b.tasks,g,!0)}}),a.addClickEvent(c.todoCheckIcon,function(){for(var d=c.todoDefault[0].getAttribute("data-task-id"),e=0;e<b.tasks.length;e++)b.tasks[e].id==d&&(b.tasks[e].isDone?alert("该任务已经完成啦！o(≧v≦)o~~"):confirm("任务完成后不能修改啦~")&&(b.tasks[e].isDone=!0,b.updateData(b.cates,b.lists,b.tasks),c.refreshCate(b.cates,b.lists),c.refreshInventory(b.tasks,b.tasks[e].cateList.taskList,"all"),c.renderFirstItem(),a.silder.init()&&a.silder.goIndex("1")))}),a.addClickEvent(c.todoEditIcon,function(){var d=c.todoDefault[0].getAttribute("data-task-id");if(c.isTaskDefault(d)){var e=c.isTaskDefault(d);e.isDone?alert("该任务已完成，不能编辑喽(～￣▽￣)～"):confirm("确认编辑"+e.title+"任务吗？")&&c.renderEditChange("edit"),a.addClickEvent(c.todoUndoEle,c.reback),c.todoCheckEle.onclick=function(){if(a.checkTask(c.todoEdit[0],c.todoEdit[1],c.todoEdit[2])&&confirm("任务编辑完成，确认提交吗？")){var d=a.checkTask(c.todoEdit[0],c.todoEdit[1],c.todoEdit[2]);e.title=d[0],e.time=d[1],e.content=d[2],b.updateData(b.cates,b.lists,b.tasks),c.refreshInventory(b.tasks,e.cateList.taskList,"all"),c.refreshCate(b.cates,b.lists),c.renderCount(),c.renderEditChange("check"),c.addContent(e)}}}})};return{start:e,listen:f}});